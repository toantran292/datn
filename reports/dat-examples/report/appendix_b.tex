% Biến kiểm soát
\newif\iflandscapepage
\landscapepagefalse

\setlength{\TPHorizModule}{1cm}
\setlength{\TPVertModule}{1cm}

\fancypagestyle{lscape}{%
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
    \fancyhead[C]{%
        % Header bên trái trang (trên của landscape) - xoay 90 độ
        \begin{textblock}{1}(1,1)
            \rotatebox{90}{%
                \parbox{27.5cm}{%
                    \fontsize{10pt}{12pt}\selectfont\itshape 
                    Xây dựng Nền tảng SaaS tích hợp AI nhằm Thống nhất Quản lý Dự án Agile - Phân hệ nền tảng và thông tin
                    \vspace{2pt}
                    \hrule
                }%
            }
        \end{textblock}
        % Footer bên phải trang (dưới của landscape) - xoay 90 độ  
        \begin{textblock}{1}(20,1)
            \rotatebox{90}{%
                \parbox{27.5cm}{%
                    \hrule
                    \vspace{2pt}
                    Nguyễn Tuấn Đạt - B2203499 \hfill Trang \thepage
                }%
            }
        \end{textblock}
    }
}

\begin{landscape}
\pagestyle{lscape}

\phantomsection
\setsection{Phụ lục B: Từ điển dữ liệu}

Phần này trình bày chi tiết mô tả dữ liệu cho các bảng của sơ đồ lớp của ứng dụng SaaS Platform được trình bày ở Phần II - Chương III - Thiết kế cơ sở dữ liệu - Từ điển dữ liệu.

\textbf{Bảng users: Lưu trữ thông tin của người dùng trong hệ thống}

\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{3cm}|p{2.5cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{3cm}|p{5cm}|}
\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endfirsthead

\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endhead

\hline
\endfoot
user\_id & UUID & X & & X & X & & Mã tài khoản người dùng. \\
\hline
name & String & & & & X & & Họ và tên người dùng. \\
\hline
email & String & & & X & X & & Email đăng ký. \\
\hline
password\_hash & String & & & & & & Mật khẩu đã mã hóa. \\
\hline
avatar\_url & String & & & & & & URL ảnh đại diện. \\
\hline
oauth\_provider & String & & & & & & Nhà cung cấp OAuth. \\
\hline
oauth\_id & String & & & & & & ID từ OAuth provider. \\
\hline
email\_verified & Boolean & & & & & & Trạng thái xác thực email. \\
\hline
is\_active & Boolean & & & & & & Trạng thái tài khoản. \\
\hline
last\_login\_at & Timestamp & & & & & & Thời điểm đăng nhập cuối. \\
\hline
created\_at & Timestamp & & & & X & & Ngày tạo tài khoản. \\
\hline
updated\_at & Timestamp & & & & X & & Ngày cập nhật gần nhất. \\
\hline
\end{longtable}

\textbf{Bảng workspaces: Lưu trữ thông tin workspace - không gian làm việc của nhóm}

\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{3cm}|p{2.5cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{3cm}|p{5cm}|}
\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endfirsthead

\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endhead

\hline
\endfoot
workspace\_id & UUID & X & & X & X & & Mã workspace. \\
\hline
owner\_id & UUID & & X & & X & users & User ID chủ sở hữu. \\
\hline
name & String & & & & X & & Tên workspace. \\
\hline
description & String & & & & & & Mô tả workspace. \\
\hline
logo\_url & String & & & & & & URL logo workspace. \\
\hline
settings & JSONB & & & & & & Cấu hình tùy chỉnh. \\
\hline
storage\_limit & BigInt & & & & & & Giới hạn dung lượng. \\
\hline
member\_limit & Integer & & & & & & Số thành viên tối đa. \\
\hline
is\_active & Boolean & & & & & & Trạng thái hoạt động. \\
\hline
deleted\_at & Timestamp & & & & & & Timestamp soft delete. \\
\hline
created\_at & Timestamp & & & & X & & Ngày tạo workspace. \\
\hline
updated\_at & Timestamp & & & & X & & Ngày cập nhật gần nhất. \\
\hline
\end{longtable}

\textbf{Bảng workspace\_members: Lưu trữ quan hệ giữa user và workspace}

\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{3cm}|p{2.5cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{3cm}|p{5cm}|}
\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endfirsthead

\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endhead

\hline
\endfoot
member\_id & UUID & X & & X & X & & Mã quan hệ thành viên. \\
\hline
user\_id & UUID & & X & & X & users & User tham gia workspace. \\
\hline
workspace\_id & UUID & & X & & X & workspaces & Workspace được tham gia. \\
\hline
role & Enum & & & & X & & Vai trò (OWNER, ADMIN, MEMBER). \\
\hline
joined\_at & Timestamp & & & & X & & Thời điểm tham gia. \\
\hline
created\_at & Timestamp & & & & X & & Ngày tạo record. \\
\hline
updated\_at & Timestamp & & & & X & & Ngày cập nhật gần nhất. \\
\hline
\end{longtable}

\textbf{Bảng permissions: Lưu trữ quyền tùy chỉnh chi tiết của thành viên}

\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{3cm}|p{2.5cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{3cm}|p{5cm}|}
\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endfirsthead

\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endhead

\hline
\endfoot
permission\_id & UUID & X & & X & X & & Mã quyền. \\
\hline
member\_id & UUID & & X & & X & workspace\_members & Member sở hữu quyền. \\
\hline
resource\_type & String & & & & X & & Loại resource. \\
\hline
resource\_id & UUID & & & & X & & ID của resource. \\
\hline
actions & JSONB & & & & X & & Array các actions được phép. \\
\hline
created\_at & Timestamp & & & & X & & Ngày tạo quyền. \\
\hline
updated\_at & Timestamp & & & & X & & Ngày cập nhật gần nhất. \\
\hline
\end{longtable}

\textbf{Bảng folders: Lưu trữ thông tin cấu trúc thư mục}

\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{3cm}|p{2.5cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{3cm}|p{5cm}|}
\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endfirsthead

\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endhead

\hline
\endfoot
folder\_id & UUID & X & & X & X & & Mã thư mục. \\
\hline
workspace\_id & UUID & & X & & X & workspaces & Workspace chứa folder. \\
\hline
parent\_id & UUID & & X & & & folders & Thư mục cha. \\
\hline
name & String & & & & X & & Tên thư mục. \\
\hline
path & String & & & & X & & Đường dẫn đầy đủ. \\
\hline
created\_at & Timestamp & & & & X & & Ngày tạo thư mục. \\
\hline
updated\_at & Timestamp & & & & X & & Ngày cập nhật gần nhất. \\
\hline
\end{longtable}

\textbf{Bảng files: Lưu trữ metadata của files}

\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{3cm}|p{2.5cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{3cm}|p{5cm}|}
\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endfirsthead

\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endhead

\hline
\endfoot
file\_id & UUID & X & & X & X & & Mã file. \\
\hline
workspace\_id & UUID & & X & & X & workspaces & Workspace chứa file. \\
\hline
folder\_id & UUID & & X & & & folders & Thư mục chứa file. \\
\hline
uploaded\_by & UUID & & X & & X & users & User upload file. \\
\hline
name & String & & & & X & & Tên file. \\
\hline
size & BigInt & & & & X & & Kích thước file (bytes). \\
\hline
mime\_type & String & & & & X & & Loại MIME của file. \\
\hline
s3\_key & String & & & & X & & Key truy xuất object. \\
\hline
version & Integer & & & & & & Số phiên bản file. \\
\hline
checksum & String & & & & X & & SHA-256 checksum. \\
\hline
deleted\_at & Timestamp & & & & & & Timestamp soft delete. \\
\hline
created\_at & Timestamp & & & & X & & Thời điểm upload. \\
\hline
updated\_at & Timestamp & & & & X & & Ngày cập nhật gần nhất. \\
\hline
\end{longtable}

\textbf{Bảng file\_shares: Lưu trữ thông tin chia sẻ file}

\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{3cm}|p{2.5cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{3cm}|p{5cm}|}
\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endfirsthead

\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endhead

\hline
\endfoot
share\_id & UUID & X & & X & X & & Mã chia sẻ. \\
\hline
file\_id & UUID & & X & & X & files & File được chia sẻ. \\
\hline
shared\_by & UUID & & X & & X & users & User thực hiện chia sẻ. \\
\hline
shared\_with & UUID & & X & & & users & User nhận chia sẻ. \\
\hline
public\_link\_token & String & & & & & & Token cho public link. \\
\hline
permissions & String & & & & X & & Quyền chia sẻ. \\
\hline
expires\_at & Timestamp & & & & & & Thời hạn chia sẻ. \\
\hline
created\_at & Timestamp & & & & X & & Thời điểm tạo share. \\
\hline
\end{longtable}

\textbf{Bảng notifications: Lưu trữ thông báo của người dùng}

\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{3cm}|p{2.5cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{3cm}|p{5cm}|}
\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endfirsthead

\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endhead

\hline
\endfoot
notification\_id & UUID & X & & X & X & & Mã thông báo. \\
\hline
user\_id & UUID & & X & & X & users & User nhận thông báo. \\
\hline
workspace\_id & UUID & & X & & & workspaces & Workspace liên quan. \\
\hline
type & String & & & & X & & Loại thông báo. \\
\hline
title & String & & & & X & & Tiêu đề thông báo. \\
\hline
message & String & & & & X & & Nội dung chi tiết. \\
\hline
metadata & JSONB & & & & & & Dữ liệu bổ sung. \\
\hline
read\_at & Timestamp & & & & & & Thời điểm đã đọc. \\
\hline
created\_at & Timestamp & & & & X & & Thời điểm tạo. \\
\hline
\end{longtable}

\textbf{Bảng reports: Lưu trữ báo cáo được tạo bởi AI}

\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{3cm}|p{2.5cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{3cm}|p{5cm}|}
\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endfirsthead

\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endhead

\hline
\endfoot
report\_id & UUID & X & & X & X & & Mã báo cáo. \\
\hline
workspace\_id & UUID & & X & & X & workspaces & Workspace chứa báo cáo. \\
\hline
generated\_by & UUID & & X & & X & users & User tạo báo cáo. \\
\hline
title & String & & & & X & & Tiêu đề báo cáo. \\
\hline
description & String & & & & & & Mô tả báo cáo. \\
\hline
content & JSONB & & & & X & & Nội dung báo cáo. \\
\hline
llm\_provider & String & & & & X & & LLM provider sử dụng. \\
\hline
prompt\_template & String & & & & X & & Template prompt. \\
\hline
tokens\_used & Integer & & & & X & & Số tokens tiêu thụ. \\
\hline
version & Integer & & & & & & Phiên bản báo cáo. \\
\hline
created\_at & Timestamp & & & & X & & Thời điểm tạo. \\
\hline
\end{longtable}

\textbf{Bảng audit\_logs: Lưu trữ lịch sử thao tác của người dùng}

\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{3cm}|p{2.5cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{1.8cm}|p{3cm}|p{5cm}|}
\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endfirsthead

\hline
\rowcolor{gray!20}
\textbf{Tên trường} & \textbf{Kiểu dữ liệu} & \textbf{Khóa chính} & \textbf{Khóa ngoại} & \textbf{Duy nhất} & \textbf{Bắt buộc} & \textbf{Bảng tham chiếu} & \textbf{Mô tả} \\
\hline
\endhead

\hline
\endfoot
log\_id & UUID & X & & X & X & & Mã log. \\
\hline
user\_id & UUID & & X & & & users & User thực hiện action. \\
\hline
workspace\_id & UUID & & X & & & workspaces & Workspace liên quan. \\
\hline
entity\_type & String & & & & X & & Loại entity bị tác động. \\
\hline
entity\_id & UUID & & & & X & & ID entity bị tác động. \\
\hline
action & String & & & & X & & Hành động thực hiện. \\
\hline
changes & JSONB & & & & X & & Before/after values. \\
\hline
ip\_address & String & & & & & & Địa chỉ IP. \\
\hline
user\_agent & String & & & & & & User agent string. \\
\hline
created\_at & Timestamp & & & & X & & Thời điểm action. \\
\hline
\end{longtable}

\end{landscape}
\pagestyle{fancy}

\phantomsection
\subsection*{Các yêu cầu ràng buộc cần thiết khi xử lý dữ liệu}

Phần này mô tả các ràng buộc dữ liệu cần được đảm bảo khi xử lý và lưu trữ thông tin trong hệ thống SaaS Platform.

\subsubsection*{Ràng buộc dữ liệu người dùng (Users)}

\begin{itemize}
    \item Thuộc tính \texttt{email} phải khác rỗng, duy nhất trong hệ thống, và đúng định dạng email hợp lệ.
    \item Thuộc tính \texttt{password\_hash} phải khác rỗng, được mã hóa bằng thuật toán Bcrypt với salt factor tối thiểu 12.
    \item Thuộc tính \texttt{role} phải có một trong các giá trị được định nghĩa trước: SUPER\_ADMIN, WORKSPACE\_OWNER, MEMBER.
    \item Thuộc tính \texttt{oauth\_provider} chỉ chấp nhận giá trị 'google' hoặc null nếu không sử dụng OAuth.
    \item Thuộc tính \texttt{email\_verified} phải là giá trị boolean, mặc định là false khi tạo tài khoản mới.
    \item Thuộc tính \texttt{is\_active} phải là giá trị boolean, mặc định là true khi tạo tài khoản mới.
\end{itemize}

\subsubsection*{Ràng buộc dữ liệu workspace (Workspaces)}

\begin{itemize}
    \item Thuộc tính \texttt{name} phải khác rỗng và có độ dài tối thiểu 3 ký tự, tối đa 100 ký tự.
    \item Thuộc tính \texttt{owner\_id} phải là UUID hợp lệ và tham chiếu đến một user tồn tại trong hệ thống.
    \item Thuộc tính \texttt{storage\_limit} phải là số nguyên dương, được tính bằng bytes.
    \item Thuộc tính \texttt{member\_limit} phải là số nguyên dương trong khoảng từ 1 đến 1000.
    \item Thuộc tính \texttt{settings} phải là dữ liệu JSON hợp lệ chứa cấu hình LLM provider, AI prompts, và retention policies.
    \item Thuộc tính \texttt{is\_active} phải là giá trị boolean để quản lý trạng thái active/suspended.
    \item Thuộc tính \texttt{deleted\_at} cho phép null, sử dụng cho soft delete để có thể khôi phục workspace.
\end{itemize}

\subsubsection*{Ràng buộc dữ liệu thành viên (Members)}

\begin{itemize}
    \item Thuộc tính \texttt{user\_id} và \texttt{workspace\_id} phải là UUID hợp lệ, tham chiếu đến các bản ghi tồn tại.
    \item Cặp (\texttt{user\_id}, \texttt{workspace\_id}) phải duy nhất để tránh duplicate membership.
    \item Thuộc tính \texttt{role} phải có một trong các giá trị: OWNER, ADMIN, MEMBER.
    \item Thuộc tính \texttt{permissions} phải là dữ liệu JSONB hợp lệ chứa các quyền chi tiết: read, write, delete, share cho từng resource.
    \item Thuộc tính \texttt{invitation\_token} phải là chuỗi ngẫu nhiên duy nhất nếu status là 'pending'.
    \item Thuộc tính \texttt{invitation\_expires\_at} phải là timestamp trong tương lai nếu có \texttt{invitation\_token}.
\end{itemize}

\subsubsection*{Ràng buộc dữ liệu files (Files)}

\begin{itemize}
    \item Thuộc tính \texttt{name} phải khác rỗng, có độ dài tối đa 255 ký tự.
    \item Thuộc tính \texttt{size} phải là số nguyên dương, được tính bằng bytes.
    \item Thuộc tính \texttt{mime\_type} phải khác rỗng và tuân theo chuẩn MIME type.
    \item Thuộc tính \texttt{s3\_key} phải là chuỗi duy nhất để truy xuất object trong S3/MinIO.
    \item Thuộc tính \texttt{version} phải là số nguyên dương, khởi tạo bằng 1 và tăng dần khi cập nhật file.
    \item Thuộc tính \texttt{checksum} phải là chuỗi SHA-256 hợp lệ để verify file integrity.
    \item Thuộc tính \texttt{shared\_with} phải là mảng các UUID hợp lệ tham chiếu đến users.
    \item Thuộc tính \texttt{deleted\_at} cho phép null, files sẽ bị xóa vĩnh viễn sau 30 ngày kể từ soft delete.
\end{itemize}

\subsubsection*{Ràng buộc dữ liệu thông báo (Notifications)}

\begin{itemize}
    \item Thuộc tính \texttt{user\_id} phải là UUID hợp lệ tham chiếu đến user nhận thông báo.
    \item Thuộc tính \texttt{type} phải có một trong các giá trị định nghĩa: member\_joined, file\_uploaded, mention, settings\_changed, workspace\_locked.
    \item Thuộc tính \texttt{title} phải khác rỗng, có độ dài tối đa 200 ký tự.
    \item Thuộc tính \texttt{message} phải khác rỗng, có độ dài tối đa 1000 ký tự.
    \item Thuộc tính \texttt{metadata} phải là dữ liệu JSONB hợp lệ chứa các entity IDs liên quan.
    \item Thuộc tính \texttt{delivery\_status} phải có một trong các giá trị: sent, delivered, failed.
\end{itemize}

\subsubsection*{Ràng buộc dữ liệu báo cáo (Reports)}

\begin{itemize}
    \item Thuộc tính \texttt{workspace\_id} phải là UUID hợp lệ tham chiếu đến workspace chứa báo cáo.
    \item Thuộc tính \texttt{title} phải khác rỗng, có độ dài từ 5 đến 200 ký tự.
    \item Thuộc tính \texttt{content} phải là dữ liệu JSONB hợp lệ chứa sections, insights, recommendations.
    \item Thuộc tính \texttt{llm\_provider} phải có một trong các giá trị: OpenAI, Anthropic, Google.
    \item Thuộc tính \texttt{tokens\_used} phải là số nguyên dương để tracking usage.
    \item Thuộc tính \texttt{version} phải là số nguyên dương, khởi tạo bằng 1.
\end{itemize}

\subsubsection*{Ràng buộc dữ liệu audit log (Audit Logs)}

\begin{itemize}
    \item Thuộc tính \texttt{entity\_type} phải có một trong các giá trị: user, workspace, file, member, notification, report.
    \item Thuộc tính \texttt{entity\_id} phải là UUID hợp lệ tham chiếu đến entity bị tác động.
    \item Thuộc tính \texttt{action} phải có một trong các giá trị: create, update, delete, read.
    \item Thuộc tính \texttt{changes} phải là dữ liệu JSONB hợp lệ chứa before/after values để audit trail đầy đủ.
    \item Thuộc tính \texttt{ip\_address} phải là địa chỉ IPv4 hoặc IPv6 hợp lệ.
    \item Thuộc tính \texttt{created\_at} phải là timestamp chính xác của action, không được null.
\end{itemize}

\subsubsection*{Ràng buộc chung cho toàn hệ thống}

\begin{itemize}
    \item Mọi bảng phải có primary key là UUID để tránh enumeration attacks và đảm bảo tính duy nhất.
    \item Mọi bảng phải có \texttt{created\_at} và \texttt{updated\_at} timestamps để tracking thời gian tạo và cập nhật.
    \item Các bảng quan trọng phải có \texttt{deleted\_at} timestamp để support soft delete, cho phép khôi phục dữ liệu.
    \item Foreign key constraints phải được enforce với ON DELETE CASCADE hoặc RESTRICT tùy theo business logic.
    \item Các trường chứa dữ liệu nhạy cảm (password, tokens, API keys) phải được mã hóa trước khi lưu vào database.
    \item Dữ liệu JSONB phải được validate schema trước khi lưu để đảm bảo tính toàn vẹn và nhất quán.
    \item Tất cả các trường bắt buộc (NOT NULL) phải được validate ở application layer trước khi insert/update.
    \item Các giá trị enum phải được kiểm tra strict để đảm bảo chỉ chứa các giá trị được định nghĩa.
\end{itemize}