<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>UC05 - Gửi/nhận tin nhắn</title>
    <style>
        body { font-family: 'Times New Roman', serif; font-size: 13pt; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; vertical-align: top; }
        .header-row td:first-child { width: 70%; }
        .header-row td:last-child { width: 30%; }
        ul, ol { margin: 5px 0; padding-left: 20px; }
        .section-title { font-weight: bold; }
    </style>
</head>
<body>

<table>
    <tr class="header-row">
        <td><strong>Tên chức năng:</strong> Gửi/nhận tin nhắn</td>
        <td><strong>ID:</strong> UC05</td>
    </tr>
    <tr>
        <td><strong>Người sử dụng:</strong> Member</td>
        <td><strong>Mức độ cần thiết:</strong> Bắt buộc</td>
    </tr>
    <tr>
        <td colspan="2" style="text-align: right;"><strong>Phân loại:</strong> Phức tạp</td>
    </tr>
    <tr>
        <td colspan="2">
            <p class="section-title">Các thành phần tham gia và mối quan tâm:</p>
            <ul>
                <li><strong>Member:</strong> Muốn gửi và nhận tin nhắn trong thời gian thực để trao đổi thông tin với các thành viên khác trong kênh.</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <p class="section-title">Mô tả tóm tắt:</p>
            <p>Cho phép Member gửi tin nhắn văn bản, tin nhắn có định dạng (bold, italic, code) và nhận tin nhắn từ các thành viên khác trong thời gian thực thông qua WebSocket.</p>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <p><strong>Trigger:</strong> Member mở kênh và nhập tin nhắn vào ô chat.</p>
            <p><strong>Kiểu sự kiện:</strong> External</p>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <p class="section-title">Luồng xử lý bình thường của sự kiện:</p>
            <ol>
                <li>Member mở một kênh đang tham gia.</li>
                <li>Hệ thống kết nối WebSocket và tải lịch sử tin nhắn gần nhất.</li>
                <li>Member nhập nội dung tin nhắn vào ô chat.</li>
                <li>Member nhấn "Gửi" hoặc phím Enter.</li>
                <li>Hệ thống gửi tin nhắn qua WebSocket đến server.</li>
                <li>Server lưu tin nhắn và broadcast đến tất cả thành viên trong kênh.</li>
                <li>Tin nhắn hiển thị trong khung chat của tất cả thành viên online.</li>
            </ol>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <p class="section-title">Các luồng sự kiện con (Subflows):</p>
            <ul>
                <li><strong>S1 - Gửi tin nhắn có định dạng:</strong> Member sử dụng toolbar hoặc markdown để định dạng → Gửi → Tin nhắn hiển thị với định dạng.</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <p class="section-title">Luồng luân phiên/đặc biệt (Alternative/Exceptional flows):</p>
            <p><strong>5a. Mất kết nối WebSocket:</strong></p>
            <p>6. Hệ thống tự động reconnect và đồng bộ tin nhắn bị miss.</p>
            <p><strong>5b. Tin nhắn quá dài:</strong></p>
            <p>6. Hệ thống thông báo "Tin nhắn vượt quá giới hạn ký tự".</p>

        </td>
    </tr>
    <tr>
        <td colspan="2">
            <p><strong>Kết quả:</strong> Tin nhắn được gửi và hiển thị cho tất cả thành viên trong kênh theo thời gian thực.</p>
        </td>
    </tr>
</table>

</body>
</html>