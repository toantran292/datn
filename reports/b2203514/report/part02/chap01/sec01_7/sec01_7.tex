\subsection{Các yêu cầu giao tiếp bên ngoài}

\subsubsection{Giao tiếp phần cứng}

\begin{itemize}
    \item Thiết bị phải có kết nối Internet ổn định để duy trì kết nối WebSocket cho chat real-time.
    \item Ứng dụng tương tác với người dùng qua chuột, bàn phím và màn hình.
    \item Đối với máy vi tính (ưu tiên cho trải nghiệm chat tối ưu):
    \begin{itemize}
        \item Ổ cứng: SSD hoặc HDD đủ dung lượng để lưu cache trình duyệt.
        \item RAM: Tối thiểu 4GB (32-bit) hoặc 8GB+ (64-bit) để xử lý nhiều kênh chat đồng thời.
        \item Hệ điều hành: Windows 10/11, macOS, hoặc Linux.
        \item Màn hình: Độ phân giải tối thiểu 1366x768, khuyến nghị 1920x1080 để hiển thị đầy đủ giao diện chat với panel AI.
    \end{itemize}
    \item Đối với máy tính bảng (hỗ trợ responsive):
    \begin{itemize}
        \item Hệ điều hành: iPadOS 14+ hoặc Android 10+ (tablet).
        \item RAM: Tối thiểu 4GB.
        \item Màn hình: Tối thiểu 10 inch để hiển thị giao diện chat đầy đủ.
    \end{itemize}
\end{itemize}

\subsubsection{Giao tiếp phần mềm}

\begin{itemize}
    \item Tương thích với Windows, macOS, Linux, iPadOS (ưu tiên desktop và tablet).
    \item Hoạt động ổn định trên các trình duyệt hỗ trợ WebSocket:
    \begin{itemize}
        \item Chrome (v90+), Firefox (v88+), Safari (v14+), Edge (v90+).
        \item Yêu cầu JavaScript enabled và hỗ trợ WebSocket API.
    \end{itemize}
    \item Tích hợp AI Provider cho xử lý ngôn ngữ tự nhiên:
    \begin{itemize}
        \item OpenAI Embedding API (text-embedding-3-small/large) cho tạo vector embedding.
        \item OpenAI Chat Completion API (GPT-4o-mini/GPT-4o) cho tóm tắt và hỏi đáp.
        \item Google Gemini API như alternative provider.
    \end{itemize}
    \item Tích hợp với phân hệ nền tảng:
    \begin{itemize}
        \item File Service: Lưu trữ và truy xuất tệp đính kèm trong chat.
        \item Account Service: Xác thực người dùng và lấy thông tin profile.
        \item API Gateway: Định tuyến và bảo mật API calls.
    \end{itemize}
    \item Thư viện xử lý tài liệu phía server:
    \begin{itemize}
        \item pdf-parse: Trích xuất văn bản từ PDF.
        \item mammoth: Chuyển đổi DOCX sang text/HTML.
        \item tesseract.js: OCR cho hình ảnh chứa văn bản.
    \end{itemize}
\end{itemize}

\subsubsection{Giao tiếp truyền thông}

\begin{itemize}
    \item \textbf{RESTful API (HTTPS):} Giao tiếp giữa client và server qua HTTP methods (GET, POST, PUT, DELETE) để quản lý kênh, tải lịch sử tin nhắn, tìm kiếm và gọi các tính năng AI.
    
    \item \textbf{WebSocket (WSS):} Giao thức chính cho tính năng chat real-time:
    \begin{itemize}
        \item Gửi và nhận tin nhắn tức thì.
        \item Typing indicator (hiển thị khi ai đó đang nhập).
        \item Cập nhật trạng thái đã đọc/chưa đọc.
        \item Thông báo tin nhắn mới và reaction.
        \item Đồng bộ trạng thái kênh giữa các thiết bị.
    \end{itemize}
    
    \item \textbf{Socket.io Protocol:} Sử dụng Socket.io với các tính năng:
    \begin{itemize}
        \item Auto-reconnection khi mất kết nối.
        \item Fallback to HTTP long-polling nếu WebSocket không khả dụng.
        \item Room management để broadcast tin nhắn đến đúng kênh.
        \item Binary streaming cho upload file nhỏ.
    \end{itemize}
    
    \item \textbf{Redis Pub/Sub:} Giao tiếp giữa các instance WebSocket Gateway để hỗ trợ horizontal scaling, đảm bảo tin nhắn được broadcast đến tất cả clients dù kết nối đến instance nào.
    
    \item \textbf{Rate Limiting:} Bảo vệ hệ thống khỏi spam và tấn công:
    \begin{itemize}
        \item Giới hạn số tin nhắn gửi mỗi phút.
        \item Giới hạn số request AI mỗi giờ.
        \item Giới hạn kích thước và số lượng file upload.
    \end{itemize}
    
    \item \textbf{CORS (Cross-Origin Resource Sharing):} Cấu hình cho phép frontend domain truy cập API và WebSocket server.
\end{itemize}